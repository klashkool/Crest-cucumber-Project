package com.Procurement_Modules;

import java.util.HashMap;
import java.util.List;
import java.util.Set;

import org.apache.log4j.Logger;
import org.junit.Assert;
import org.openqa.selenium.By;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.Utils.Base;
import com.Utils.CrestTestDataReader;
import com.Utils.ExcelReader;
import com.Utils.ExcelWriter;

public class Procurement_Req extends Base {

	public static Logger log = Logger.getLogger(Procurement_Req.class);
	static WebDriverWait wait = new WebDriverWait(driver, 100);
	static List<HashMap<String, String>> PO_Inv_data = CrestTestDataReader.getPOInvData();

	public static String ReqID;

	public static void PO_Req_Inv() {

		log.info("Creating PO Requirements for Inventory");
		driver.findElement(By.linkText("PROCUREMENT")).click();
		driver.findElement(By.linkText("Requirements")).click();
		driver.findElement(By.linkText("Create Requirement")).click();
		// Requirement Type DD
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("requirementTypeId")));
		Select ReqType_DD = new Select(driver.findElement(By.id("requirementTypeId")));
		ReqType_DD.selectByVisibleText("Product Requirement");
		// Organization DD
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("fromPartyId")));
		Select ReqOrg_DD = new Select(driver.findElement(By.id("fromPartyId")));
		ReqOrg_DD.selectByVisibleText("Southern Lubrication (Pvt) Ltd");

		log.info("Adding products for Requirements");
		for (int p = 0; p <= 9; p++) {
			wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("addItemType")));
			Select OrdType_DD = new Select(driver.findElement(By.id("addItemType")));
			OrdType_DD.selectByVisibleText(PO_Inv_data.get(0).get("OrderType"));

			driver.findElement(By.name("productId")).sendKeys(PO_Inv_data.get(p).get("Product ID"));
			driver.findElement(By.name("quantity")).sendKeys(PO_Inv_data.get(p).get("Qty"));

			wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("quantityUomId")));
			Select ReqUOM_DD = new Select(driver.findElement(By.id("quantityUomId")));
			ReqUOM_DD.selectByVisibleText(PO_Inv_data.get(p).get("UOM"));

			wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("departmentName")));
			Select Dept_DD = new Select(driver.findElement(By.id("departmentName")));
			Dept_DD.selectByVisibleText(PO_Inv_data.get(p).get("Dept"));

			driver.findElement(By.name("comments")).sendKeys("Automation PO Req Test");

			wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("facilityId")));
			Select Fac_DD = new Select(driver.findElement(By.id("facilityId")));

			if (p <= 4) {
				Fac_DD.selectByVisibleText(PO_Inv_data.get(1).get("Facility-ShipGroup"));
			} else if (p >= 5 && p <= 7) {
				Fac_DD.selectByVisibleText(PO_Inv_data.get(6).get("Facility-ShipGroup"));
			} else if (p >= 8 && p <= 9) {
				Fac_DD.selectByVisibleText(PO_Inv_data.get(9).get("Facility-ShipGroup"));
			}
			driver.findElement(By.name("submitProduct")).click();
		}
		wait.until(
				ExpectedConditions.visibilityOfElementLocated(By.xpath("//*[@id='createRequirements']/div[3]/input")));
		driver.findElement(By.xpath("//*[@id='createRequirements']/div[3]/input")).click();

		String ReqPO_Num = driver.findElement(By.xpath("//*[@id='editRequirements']/table/tbody[1]/tr[1]/td[2]"))
				.getText();
		System.out.println("Req ID = " + ReqPO_Num);
		ReqID = ReqPO_Num;
		ExcelWriter.writeExcelFile("PO_Inv", 15, 0, ReqPO_Num);

		driver.findElement(By.linkText("Approve")).click();

		String ReqPO_Status = driver.findElement(By.xpath("//*[@id='editRequirements']/table/tbody[1]/tr[2]/td[4]"))
				.getText();
		Assert.assertEquals("Approved", ReqPO_Status);

		System.out.println("PO Requirements for Inventory Created Successfully");
		log.info("PO Requirements for Inventory Created Successfully");

	}

}
