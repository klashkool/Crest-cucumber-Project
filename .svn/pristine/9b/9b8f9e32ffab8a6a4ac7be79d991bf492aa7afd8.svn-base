package com.Facilities_Modules;

import java.util.HashMap;
import java.util.List;

import org.apache.log4j.Logger;
import org.junit.Assert;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.Select;

import com.Sales_Modules.Sales_SalesOrder_View;
import com.Utils.Base;
import com.Utils.CrestTestDataReader;
import com.Utils.ExcelWriter;
import com.Utils.WebdriverWait;

public class Facilities_Shipments extends Base {

	public static Logger log = Logger.getLogger(Facilities_Shipments.class);
	static List<HashMap<String, String>> PO_Inv_data = CrestTestDataReader.getPOInvData();
	static List<HashMap<String, String>> PO_Inv_Adhoc_data = CrestTestDataReader.getPOInvAdhocData();
	static List<HashMap<String, String>> SO_data = CrestTestDataReader.getSOData();

	// Scenario: Receive PO Inventory

	public static void ReceiveInv() {

		for (int Shp = 1; Shp <= 4; Shp++) {

			log.info("Receiving Inventory for all the products");

			WebdriverWait.findElement("link", "FACILITIES").click();
			WebdriverWait.findElement("link", "Shipments").click();
			WebdriverWait.findElement("link", "Create Shipment").click();

			Select ShpType_DD = new Select(WebdriverWait.findElement("id", "shipmentTypeId"));
			ShpType_DD.selectByVisibleText("Purchase Shipment");

			WebdriverWait.findElement("id", "0_lookupId_primaryOrderId").sendKeys(PO_Inv_data.get(14).get("Supplier"));
			WebdriverWait.findElement("id", "additionalShippingCharge").click();

			Select F_ShipGrp_DDN = new Select(WebdriverWait.findElement("id", "primaryShipGroupSeqId"));
			if (Shp == 1) {
				log.info("Receiving Inventory with partial qty for Ship1");
				F_ShipGrp_DDN.selectByVisibleText(PO_Inv_data.get(0).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship1 = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[1]/td[2]")
						.getText();
				ExcelWriter.writeExcelFile("PO_Inv", 15, 4, Ship1);

				WebdriverWait.findElement("link", "Order Items").click();
				WebdriverWait.findElement("xpath", "//*[@id='FindOrderItems']/table/tbody/tr[3]/td/input").click();

				List<WebElement> Shpqty_List = WebdriverWait.findElements("xpath",
						"//*[@id='AddOrderItems']/table/tbody/tr");
				System.out.println(Shpqty_List.size());
				for (int a = 2; a <= Shpqty_List.size(); a++) {
					String PrdId = WebdriverWait
							.findElement("xpath", "//*[@id='AddOrderItems']/table/tbody/tr[" + a + "]/td[4]").getText();
					System.out.println(PrdId);

					System.out.println("PRODUCT ID" + a);
					if (PrdId.equalsIgnoreCase("DNPFT001")) {
						WebdriverWait.findElement("id", "quantity_o_" + (a - 2)).clear();
						WebdriverWait.findElement("id", "quantity_o_" + (a - 2)).sendKeys("900");

						String x = WebdriverWait.findElement("id", "quantity_o_" + (a - 2)).getText();
						System.out.println("TEXT ID" + x);

						WebdriverWait.findElement("xpath", "//*[@id='AddOrderItems']/div/input").click();
						WebdriverWait.findElement("link", "Receive Inventory").click();
						System.out.println("PRODUCT ID" + a);

						for (int j = 0; j <= 4; j++) {
							Select Loc_DD = new Select(WebdriverWait.findElement("id", "locationSeqId_o_" + j));
							Loc_DD.selectByVisibleText("500");
						}
						WebdriverWait.findElement("link", "Receive").click();
						WebdriverWait.findElement("xpath",
								"//*[@id='content-main-section']/div[2]/table/tbody/tr[2]/td[1]/a").click();
						String Ship1_status = WebdriverWait
								.findElement("xpath",
										"//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[2]/td[4]")
								.getText();
						Assert.assertEquals("Received", Ship1_status);
						log.info("Ship1 received successfully");
						break;
					}
				}
			} else if (Shp == 2) {
				log.info("Receiving Inventory with remaining partial qty for Ship1");
				F_ShipGrp_DDN.selectByVisibleText(PO_Inv_data.get(0).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship2 = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[1]/td[2]")
						.getText();
				ExcelWriter.writeExcelFile("PO_Inv", 16, 4, Ship2);

				WebdriverWait.findElement("link", "Order Items").click();
				WebdriverWait.findElement("xpath", "//*[@id='FindOrderItems']/table/tbody/tr[3]/td/input").click();
				WebdriverWait.findElement("xpath", "//*[@id='AddOrderItems']/div/input").click();
				WebdriverWait.findElement("link", "Receive Inventory").click();

				Select Dept_DD = new Select(WebdriverWait.findElement("id", "locationSeqId_o_0"));
				Dept_DD.selectByVisibleText("500");

				WebdriverWait.findElement("link", "Receive").click();
				WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/table/tbody/tr[2]/td[1]/a")
						.click();
				String Ship2_status = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[2]/td[4]")
						.getText();
				Assert.assertEquals("Received", Ship2_status);
				log.info("Ship1 remaining qty received successfully");
			} else if (Shp == 3) {
				log.info("Receiving Inventory with Full qty for Ship2");
				F_ShipGrp_DDN.selectByVisibleText(PO_Inv_data.get(5).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship3 = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[1]/td[2]")
						.getText();
				ExcelWriter.writeExcelFile("PO_Inv", 17, 4, Ship3);

				WebdriverWait.findElement("link", "Order Items").click();
				WebdriverWait.findElement("xpath", "//*[@id='FindOrderItems']/table/tbody/tr[3]/td/input").click();
				WebdriverWait.findElement("xpath", "//*[@id='AddOrderItems']/div/input").click();
				WebdriverWait.findElement("link", "Receive Inventory").click();
				WebdriverWait.findElement("link", "Receive").click();

				WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/table/tbody/tr[2]/td[1]/a")
						.click();
				String Ship3_status = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[2]/td[4]")
						.getText();
				Assert.assertEquals("Received", Ship3_status);
				log.info("Ship3 received successfully");

			} else if (Shp == 4) {
				log.info("Receiving Inventory with Full qty for Ship4");
				F_ShipGrp_DDN.selectByVisibleText(PO_Inv_data.get(8).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship4 = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[1]/td[2]")
						.getText();
				ExcelWriter.writeExcelFile("PO_Inv", 18, 4, Ship4);

				WebdriverWait.findElement("link", "Order Items").click();
				WebdriverWait.findElement("xpath", "//*[@id='FindOrderItems']/table/tbody/tr[3]/td/input").click();
				WebdriverWait.findElement("xpath", "//*[@id='AddOrderItems']/div/input").click();
				WebdriverWait.findElement("link", "Receive Inventory").click();
				WebdriverWait.findElement("link", "Receive").click();
				WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/table/tbody/tr[2]/td[1]/a")
						.click();
				String Ship4_status = WebdriverWait
						.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[2]/td[4]")
						.getText();
				Assert.assertEquals("Received", Ship4_status);
				log.info("Ship4 received successfully");
				WebdriverWait.findElement("xpath", "//*[@id='primaryOrderIdRowAndPrimaryShipGroupSeqId']/td[2]/a")
						.click();
			}
		}
	}

	public static void CaptureInvID() {

		log.info("Receiving Inventory for all the products");
		int j = 15;
		for (int Inv = 1; Inv <= 4; Inv++) {

			String bpath = "//*[@id='content-main-section']/div[5]/div[2]/table/tbody[";
			String apath = "]/tr/td[1]";// Inv ID

			String InvID = WebdriverWait.findElement("xpath", bpath + Inv + apath).getText();

			ExcelWriter.writeExcelFile("PO_Inv", j, 5, InvID);
			j++;
		}
	}

//************************************************************************************************************************************************//
	// PO With Adhoc Flow
//************************************************************************************************************************************************//

	public static void PO_Adhoc_ReceiveInv() {

		log.info("Receiving Inventory for all the products");

		WebdriverWait.findElement("link", "FACILITIES").click();
		WebdriverWait.findElement("link", "Shipments").click();
		WebdriverWait.findElement("link", "Create Shipment").click();

		Select ShpType_DD = new Select(WebdriverWait.findElement("id", "shipmentTypeId"));
		ShpType_DD.selectByVisibleText("Purchase Shipment");

		WebdriverWait.findElement("id", "0_lookupId_primaryOrderId")
				.sendKeys(PO_Inv_Adhoc_data.get(13).get("Supplier"));
		WebdriverWait.findElement("id", "additionalShippingCharge").click();

		Select F_ShipGrp_DDN = new Select(WebdriverWait.findElement("id", "primaryShipGroupSeqId"));
		F_ShipGrp_DDN.selectByVisibleText(PO_Inv_Adhoc_data.get(0).get("Facility-ShipGroup"));

		WebdriverWait.findElement("id", "createSubmit").click();
		String InvPrd = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[1]/td[2]")
				.getText();
		ExcelWriter.writeExcelFile("PO_Adhoc", 14, 4, InvPrd);

		WebdriverWait.findElement("link", "Order Items").click();
		WebdriverWait.findElement("xpath", "//*[@id='FindOrderItems']/table/tbody/tr[3]/td/input").click();
		WebdriverWait.findElement("xpath", "//*[@id='AddOrderItems']/div/input").click();
		WebdriverWait.findElement("link", "Receive Inventory").click();

		for (int j = 0; j <= 3; j++) {
			Select Loc_DD = new Select(WebdriverWait.findElement("id", "locationSeqId_o_" + j));
			Loc_DD.selectByVisibleText("500");
		}

		WebdriverWait.findElement("link", "Receive").click();
		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/table/tbody/tr[2]/td[1]/a").click();
		String InvShip_status = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/table/tbody/tr[2]/td[4]")
				.getText();
		Assert.assertEquals("Received", InvShip_status);
		log.info("Inventory Shipment received successfully");

	}

//************************************************************************************************************************************************//
	// SO Normal Flow
//************************************************************************************************************************************************//

	public static void SO_CreateShipment() throws InterruptedException {

		for (int Shp = 1; Shp <= 4; Shp++) {

			log.info("Create Shipments for all the products");

			WebdriverWait.findElement("link", "FACILITIES").click();
			WebdriverWait.findElement("link", "Shipments").click();
			WebdriverWait.findElement("link", "Create Shipment").click();

			Select ShpType_DD = new Select(WebdriverWait.findElement("id", "shipmentTypeId"));
			ShpType_DD.selectByVisibleText("Sales Shipment");

			WebdriverWait.findElement("id", "0_lookupId_primaryOrderId").sendKeys(SO_data.get(14).get("Customer"));
			WebdriverWait.findElement("id", "picklistBinId").click();

			Select F_ShipGrp_DDN = new Select(WebdriverWait.findElement("id", "primaryShipGroupSeqId"));
			if (Shp == 1) {
				log.info("Create Shipment with partial qty for Ship1");
				F_ShipGrp_DDN.selectByVisibleText(SO_data.get(0).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship1 = WebdriverWait.findElement("id", "shipmentIdDisplay").getText();
				ExcelWriter.writeExcelFile("SO", 15, 4, Ship1);

				Facilities_Shipments_OrderItems.SO_Partial_Shpmnt();
				Facilities_Shipments_Edit.ShpStatus();

			} else if (Shp == 2) {

				log.info("Create Shipment for remaining partial qty for Ship1");
				F_ShipGrp_DDN.selectByVisibleText(SO_data.get(0).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship2 = WebdriverWait.findElement("id", "shipmentIdDisplay").getText();
				ExcelWriter.writeExcelFile("SO", 16, 4, Ship2);

				Facilities_Shipments_OrderItems.SO_Full_Shpmnt();
				Facilities_Shipments_Edit.ShpStatus();

			} else if (Shp == 3) {

				log.info("Receiving Inventory with Full qty for Ship2");
				F_ShipGrp_DDN.selectByVisibleText(SO_data.get(5).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship2 = WebdriverWait.findElement("id", "shipmentIdDisplay").getText();
				ExcelWriter.writeExcelFile("SO", 17, 4, Ship2);

				Facilities_Shipments_OrderItems.SO_Full_Shpmnt();
				Facilities_Shipments_Edit.ShpStatus();

			} else if (Shp == 4) {

				log.info("Receiving Inventory with Full qty for Ship4");
				F_ShipGrp_DDN.selectByVisibleText(SO_data.get(8).get("Facility-ShipGroup"));
				WebdriverWait.findElement("id", "createSubmit").click();
				String Ship2 = WebdriverWait.findElement("id", "shipmentIdDisplay").getText();
				ExcelWriter.writeExcelFile("SO", 18, 4, Ship2);

				Facilities_Shipments_OrderItems.SO_Full_Shpmnt();
				Facilities_Shipments_Edit.ShpStatus();
			}
		}

		// Capturing all the Invoice ID's
		Sales_SalesOrder_View.SO_CaptureInvID();
	}
}
