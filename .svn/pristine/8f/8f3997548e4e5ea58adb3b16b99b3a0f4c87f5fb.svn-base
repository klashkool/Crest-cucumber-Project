package com.Procurement_Modules;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Set;

import org.apache.log4j.Logger;
import org.junit.Assert;
import org.openqa.selenium.By;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.Utils.Base;
import com.Utils.ExcelReader;
import com.Utils.ExcelWriter;

public class Procurement_RFQ extends Base {
	
	public static Logger log = Logger.getLogger(Procurement_RFQ.class);
	WebDriverWait wait = new WebDriverWait(driver, 100);
	List<HashMap<String, String>> PO_Inv_data = (List<HashMap<String, String>>) ExcelReader.readExcelDatafromFile(
			"D:\\Projects\\CrestCucumber\\src\\main\\java\\com\\Utils\\Crest_TestData.xlsx", "PO_Inv");		
	
	public static String RFQID;	
	
public void PO_RFQ_Inv() {
		
		log.info("Creating RFQ for PO Inventory");
		driver.findElement(By.linkText("Create RFQ")).click();
		driver.findElement(By.xpath("//*[@id='custRequestName']")).sendKeys("PO Automation Test");
		//Organization DD
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("fromPartyId")));
		Select ReqOrg_DD = new Select(driver.findElement(By.id("fromPartyId")));
		ReqOrg_DD.selectByVisibleText("Southern Lubrication (Pvt) Ltd");	
		//Adding Request Date
		//Adding Current Date(From Date)
		SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
		String Fromdate = (dateFormat.format(new Date()));
		driver.findElement(By.name("custRequestDate_i18n")).clear();
		driver.findElement(By.name("custRequestDate_i18n")).sendKeys(Fromdate);		
		//Response Required Date		
		//Adding 10days extra from Current Date(ToDate)		
		SimpleDateFormat dateFormat1 = new SimpleDateFormat("dd/MM/yyyy");
		Calendar cal = Calendar.getInstance();
		cal.setTime(new Date());
		cal.add(Calendar.DATE, 10);
		String newDate = dateFormat1.format(cal.getTime());
		driver.findElement(By.name("responseRequiredDate_i18n")).sendKeys(newDate);		
		//Numbering Type DD
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("numberingFormatId")));
		Select NumType_DD = new Select(driver.findElement(By.id("numberingFormatId")));
		NumType_DD.selectByVisibleText("RFQ");	
		//Category DD
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("custRequestCategoryId")));
		Select Category_DD = new Select(driver.findElement(By.id("custRequestCategoryId")));
		Category_DD.selectByVisibleText("From Requirement");
		
		driver.findElement(By.xpath("//*[@id='content-main-section']/div/a[1]")).click();//Create Button
		
		String RFQ_Status = driver.findElement(By.xpath("//*[@id='content-messages']/div/p")).getText();
		Assert.assertEquals("RFQ Created Successfully", RFQ_Status);		
		System.out.println("RFQ Created Successfully");
		
		driver.findElement(By.linkText("RFQ Header")).click();
		String RFQPO_Num = driver.findElement(By.xpath("//*[@id='content-main-section']/form[1]/div[1]/div[2]/table/tbody[1]/tr[1]/td[2]")).getText();
		System.out.println("RFQ ID = " + RFQPO_Num);
		RFQID = RFQPO_Num;
		ExcelWriter.writeExcelFile("PO_Inv", 15, 1, RFQPO_Num);
		driver.findElement(By.linkText("RFQ Item")).click();
		
		//Need to be Tested
		driver.findElement(By.id("0_lookupId_requirementId")).sendKeys(PO_Inv_data.get(14).get("S.No"));
		driver.findElement(By.xpath("//*[@id='content-main-section']/div/div[2]/form/table/tbody/tr/td[3]/input")).click();
		
		driver.findElement(By.xpath("//*[@id='content-main-section']/form[1]/div[2]/input")).click();//Add Items
		driver.findElement(By.linkText("Update Quote Info")).click();		
	}
	

}
