package com.Procurement_Modules;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.List;

import org.apache.log4j.Logger;
import org.junit.Assert;
import org.openqa.selenium.support.ui.Select;

import com.Utils.Base;
import com.Utils.CrestTestDataReader;
import com.Utils.ExcelWriter;
import com.Utils.WebdriverWait;

public class Procurement_PurchaseOrder extends Base {

	public static Logger log = Logger.getLogger(Procurement_PurchaseOrder.class);
	// static List<HashMap<String, String>> PO_Inv_data =
	// CrestTestDataReader.getPOInvData();
	static List<HashMap<String, String>> PO_Inv_Adhoc_data = CrestTestDataReader.getPOInvAdhocData();
	static List<HashMap<String, String>> PO_Enc_data = CrestTestDataReader.getPOEncData();

	public static String po_Number;
	public static String AdhocPo_Number;
	public static String EncPo_Number;

	public static void PO_Start_Order(List<HashMap<String, String>> data, String poname, String order_type) {

		log.info("Creating a New PO");
		WebdriverWait.findElement("link", "PROCUREMENT").click();
		WebdriverWait.findElement("link", "Purchase Order").click();
		WebdriverWait.findElement("link", "Create Purchase Order").click();

		Select Org_DD = new Select(WebdriverWait.findElement("id", "billToCustomerPartyId"));
		Org_DD.selectByVisibleText(data.get(0).get("Organization"));

		Select Sup_DD = new Select(WebdriverWait.findElement("id", "supplierPartyId"));
		Sup_DD.selectByVisibleText(data.get(0).get("Supplier"));

		WebdriverWait.findElement("id", "orderName").sendKeys(poname);

		Select Ordtype_DD = new Select(WebdriverWait.findElement("id", "orderType"));
		Ordtype_DD.selectByVisibleText(order_type);

		Select Currency_DD = new Select(WebdriverWait.findElement("id", "currencyUomId"));
		Currency_DD.selectByVisibleText(data.get(0).get("Currency"));

		WebdriverWait.findElement("id", "workeffortId").sendKeys("");

		SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
		String Fromdate = (dateFormat.format(new Date()));
		WebdriverWait.findElement("name", "orderDate_i18n").sendKeys(Fromdate);

		Select NumType_DD = new Select(WebdriverWait.findElement("id", "numberingFormatId"));
		NumType_DD.selectByVisibleText("1234");

		Select Payterm_DD = new Select(WebdriverWait.findElement("id", "agreementId"));
		Payterm_DD.selectByVisibleText("-Select-");

		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/form/div[3]/div[3]/a[1]").click();
	}

	public static void PO_Shipping_Details(List<HashMap<String, String>> data) {

		log.info("Adding Ship Groups");
		String facility = "_facilityId";

		for (int a = 0; a <= 2; a++) {
			Select Shpfacility = new Select(WebdriverWait.findElement("id", a + facility));
			if (a == 0) {
				Shpfacility.selectByVisibleText(data.get(1).get("Facility-ShipGroup"));
				WebdriverWait.findElement("name", "newShipGroup").click();
			} else if (a == 1) {
				Shpfacility.selectByVisibleText(data.get(6).get("Facility-ShipGroup"));
				WebdriverWait.findElement("name", "newShipGroup").click();
			} else if (a == 2) {
				Shpfacility.selectByVisibleText(data.get(9).get("Facility-ShipGroup"));
			}
		}
		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/div/a[1]").click();
	}

	public static void PO_OrderItems(List<HashMap<String, String>> data) throws InterruptedException {

		log.info("Adding products");
		for (int p = 0; p <= 9; p++) {
			Select OrdType_DD = new Select(WebdriverWait.findElement("id", "addItemType"));
			OrdType_DD.selectByVisibleText(data.get(0).get("OrderType"));
			Thread.sleep(1000);
			WebdriverWait.findElement("name", "add_product_id").sendKeys(data.get(p).get("Product ID"));
			WebdriverWait.findElement("name", "quantity").sendKeys(data.get(p).get("Qty"));

			Select UOM_DD = new Select(WebdriverWait.findElement("id", "quantityUomId"));
			UOM_DD.selectByVisibleText(data.get(p).get("UOM"));

			Select Dept_DD = new Select(WebdriverWait.findElement("id", "departmentName"));
			Dept_DD.selectByVisibleText(data.get(p).get("Dept"));

			WebdriverWait.findElement("name", "itemComment").sendKeys("Test");

			Select Fac_DD = new Select(WebdriverWait.findElement("id", "toGroupIndex"));

			if (p <= 4) {
				Fac_DD.selectByVisibleText(data.get(0).get("Facility-ShipGroup"));
			} else if (p >= 5 && p <= 7) {
				Fac_DD.selectByVisibleText(data.get(5).get("Facility-ShipGroup"));
			} else if (p >= 8 && p <= 9) {
				Fac_DD.selectByVisibleText(data.get(8).get("Facility-ShipGroup"));
			}

			WebdriverWait.findElement("name", "submitItems").click();
		}
		WebdriverWait.findElement("link", "Continue").click();
	}

	public static void PO_ReviewCreatePO(String sheetname) {

		WebdriverWait.findElement("link", "Create").click();
		Procurement_PurchaseOrder_View.POnum_Capture(sheetname);
	}



//************************************************************************************************************************************************//
	// PO With Adhoc Flow
//************************************************************************************************************************************************//

	public static void PO_Adhoc_Start_Order() {

		log.info("Creating a New PO for PO Adhoc Flow");
		WebdriverWait.findElement("link", "PROCUREMENT").click();
		WebdriverWait.findElement("link", "Purchase Order").click();
		WebdriverWait.findElement("link", "Create Purchase Order").click();

		Select Org_DD = new Select(WebdriverWait.findElement("id", "billToCustomerPartyId"));
		Org_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(0).get("Organization"));

		Select Sup_DD = new Select(WebdriverWait.findElement("id", "supplierPartyId"));
		Sup_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(0).get("Supplier"));

		WebdriverWait.findElement("id", "orderName").sendKeys("PO Automation Inv & Adhoc Flow");

		Select Ordtype_DD = new Select(WebdriverWait.findElement("id", "orderType"));
		Ordtype_DD.selectByVisibleText("Normal");

		Select Currency_DD = new Select(WebdriverWait.findElement("id", "currencyUomId"));
		Currency_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(0).get("Currency"));

		Select NumType_DD = new Select(WebdriverWait.findElement("id", "numberingFormatId"));
		NumType_DD.selectByVisibleText("Purchase Order");

		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/form/div[3]/div[3]/a[1]").click();
	}

	public static void PO_Adhoc_Add_ShpGrps() {

		log.info("Adding Ship Groups for PO Adhoc Flow");
		String facility = "_facilityId";

		for (int a = 0; a <= 2; a++) {
			Select Shpfacility = new Select(WebdriverWait.findElement("id", a + facility));
			if (a == 0) {
				Shpfacility.selectByVisibleText(PO_Inv_Adhoc_data.get(1).get("Facility-ShipGroup"));
				System.out.println(PO_Inv_Adhoc_data.get(1).get("Facility-ShipGroup"));
				WebdriverWait.findElement("name", "newShipGroup").click();
			} else if (a == 1) {
				Shpfacility.selectByVisibleText(PO_Inv_Adhoc_data.get(5).get("Facility-ShipGroup"));
				System.out.println(PO_Inv_Adhoc_data.get(5).get("Facility-ShipGroup"));
				WebdriverWait.findElement("name", "newShipGroup").click();
			} else if (a == 2) {
				Shpfacility.selectByVisibleText(PO_Inv_Adhoc_data.get(8).get("Facility-ShipGroup"));
				System.out.println(PO_Inv_Adhoc_data.get(8).get("Facility-ShipGroup"));
			}
		}
		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/div/a[1]").click();
	}

	public static void PO_Adhoc_Add_Prd() throws InterruptedException {

		log.info("Adding Inv products & Adhoc Products");
		for (int p = 0; p <= 8; p++) {

			if (p <= 3) {
				Select OrdType_DD = new Select(WebdriverWait.findElement("id", "addItemType"));
				OrdType_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("OrderType"));

				Thread.sleep(1000);

				WebdriverWait.findElement("name", "add_product_id")
						.sendKeys(PO_Inv_Adhoc_data.get(p).get("Product ID"));
				WebdriverWait.findElement("name", "quantity").sendKeys(PO_Inv_Adhoc_data.get(p).get("Qty"));

				Select UOM_DD = new Select(WebdriverWait.findElement("id", "quantityUomId"));
				UOM_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("UOM"));

				Select Dept_DD = new Select(WebdriverWait.findElement("id", "departmentName"));
				Dept_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("Dept"));

				WebdriverWait.findElement("name", "itemComment").sendKeys("Test");

				Select Fac_DD = new Select(WebdriverWait.findElement("id", "toGroupIndex"));
				Fac_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(0).get("Facility-ShipGroup"));

				WebdriverWait.findElement("name", "submitItems").click();

			} else if (p >= 4 && p <= 6) {

				Select OrdType_DD = new Select(WebdriverWait.findElement("id", "addItemType"));
				OrdType_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("OrderType"));

				Thread.sleep(2000);

				WebdriverWait.findElement("name", "add_item_description")
						.sendKeys(PO_Inv_Adhoc_data.get(p).get("Product ID"));
				WebdriverWait.findElement("xpath", "//*[@id='adHoc']/table/tbody/tr[2]/td[2]/input")
						.sendKeys(PO_Inv_Adhoc_data.get(p).get("Qty"));
				WebdriverWait.findElement("name", "price").sendKeys(PO_Inv_Adhoc_data.get(p).get("Purchase Price"));

				Select TaxCat_DD = new Select(WebdriverWait.findElement("id", "gstCategoryId"));
				TaxCat_DD.selectByVisibleText("GST 5%");

				Select Dept_DD = new Select(WebdriverWait.findElement("id", "departmentName1"));
				Dept_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("Dept"));

				Select Fac_DD = new Select(WebdriverWait.findElement("xpath",
						"/html/body/div[2]/div[4]/div/div[1]/div[2]/div[2]/form[2]/div/table/tbody/tr[4]/td[4]/select"));
				Fac_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(4).get("Facility-ShipGroup"));

				WebdriverWait.findElement("xpath", "//*[@id='adHoc']/table/tbody/tr[6]/td[2]/input").click();

			} else if (p >= 7 && p <= 8) {

				Select OrdType_DD = new Select(WebdriverWait.findElement("id", "addItemType"));
				OrdType_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("OrderType"));

				Thread.sleep(2000);

				WebdriverWait.findElement("name", "add_item_description")
						.sendKeys(PO_Inv_Adhoc_data.get(p).get("Product ID"));
				WebdriverWait.findElement("xpath", "//*[@id='adHoc']/table/tbody/tr[2]/td[2]/input")
						.sendKeys(PO_Inv_Adhoc_data.get(p).get("Qty"));
				WebdriverWait.findElement("name", "price").sendKeys(PO_Inv_Adhoc_data.get(p).get("Purchase Price"));

				Select TaxCat_DD = new Select(WebdriverWait.findElement("id", "gstCategoryId"));
				TaxCat_DD.selectByVisibleText("GST 18%");

				Select Dept_DD = new Select(WebdriverWait.findElement("id", "departmentName1"));
				Dept_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(p).get("Dept"));

				Select Fac_DD = new Select(WebdriverWait.findElement("xpath",
						"/html/body/div[2]/div[4]/div/div[1]/div[2]/div[2]/form[2]/div/table/tbody/tr[4]/td[4]/select"));
				Fac_DD.selectByVisibleText(PO_Inv_Adhoc_data.get(7).get("Facility-ShipGroup"));

				WebdriverWait.findElement("xpath", "//*[@id='adHoc']/table/tbody/tr[6]/td[2]/input").click();
			}
		}
		WebdriverWait.findElement("link", "Continue").click();
		WebdriverWait.findElement("link", "Create").click();
		log.info("PO Number Created Successfully");

		String AdhocPO_Num = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[1]/div[2]/table/tbody/tr[1]/td[2]/a")
				.getText();
		System.out.println("Adhoc PO Number = " + AdhocPO_Num);
		AdhocPo_Number = AdhocPO_Num;
		ExcelWriter.writeExcelFile("PO_Adhoc", 14, 3, AdhocPO_Num);

	}

	public static void PO_Adhoc_GrdTotal_Val() {

		log.info("Validating GrandTotal");
		String PO_AdhocGrdTotal = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[6]/div[2]/table/tbody/tr[13]/td[3]/span")
				.getText().replace("₹", "").replace(",", "");
		System.out.println(PO_AdhocGrdTotal);
		System.out.println(PO_Inv_Adhoc_data.get(16).get("Dept"));
		Assert.assertEquals(PO_Inv_Adhoc_data.get(16).get("Dept"), PO_AdhocGrdTotal);
		log.info("Grand Total & Tax Amt validated Successfully for PO Adhoc Flow");
	}

	public static void Po_Adhoc_Approve_Po() {

		log.info("Approve PO for Adhoc");
		WebdriverWait.findElement("link", "Review Order").click();
		WebdriverWait.findElement("link", "Review 2 Order").click();
		WebdriverWait.findElement("link", "Approve Order").click();
		String App_Status_Val = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[1]/div[2]/table/tbody/tr[5]/td[2]")
				.getText();
		Assert.assertEquals("Approved", App_Status_Val);
		log.info("Status validated successfully as Approved");

	}

//************************************************************************************************************************************************//
	// PO With Encumbrance Flow
//************************************************************************************************************************************************//

	public static void PO_Enc_Start_Order() {

		log.info("Creating a New PO Encumbrance Flow");
		WebdriverWait.findElement("link", "PROCUREMENT").click();
		WebdriverWait.findElement("link", "Purchase Order").click();
		WebdriverWait.findElement("link", "Create Purchase Order").click();

		Select Org_DD = new Select(WebdriverWait.findElement("id", "billToCustomerPartyId"));
		Org_DD.selectByVisibleText(PO_Enc_data.get(0).get("Organization"));

		Select Sup_DD = new Select(WebdriverWait.findElement("id", "supplierPartyId"));
		Sup_DD.selectByVisibleText(PO_Enc_data.get(0).get("Supplier"));

		WebdriverWait.findElement("id", "orderName").sendKeys("PO Automation Encumbrance Flow");

		Select Ordtype_DD = new Select(WebdriverWait.findElement("id", "orderType"));
		Ordtype_DD.selectByVisibleText("Encumbrance");

		Select Currency_DD = new Select(WebdriverWait.findElement("id", "currencyUomId"));
		Currency_DD.selectByVisibleText(PO_Enc_data.get(0).get("Currency"));

		// Adding Current Date(From Date)
		SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
		String Fromdate = (dateFormat.format(new Date()));
		WebdriverWait.findElement("name", "fromDate_i18n").sendKeys(Fromdate);

		// Adding 10days extra from Current Date(ToDate)
		SimpleDateFormat dateFormat1 = new SimpleDateFormat("dd/MM/yyyy");
		Calendar cal = Calendar.getInstance();
		cal.setTime(new Date());
		cal.add(Calendar.DATE, 10);
		String newDate = dateFormat.format(cal.getTime());
		WebdriverWait.findElement("id", "thruDate_i18n").sendKeys(newDate);

		Select NumType_DD = new Select(WebdriverWait.findElement("id", "numberingFormatId"));
		NumType_DD.selectByVisibleText("Purchase Order");

		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/form/div[3]/div[3]/a[1]").click();
	}

	public static void PO_Enc_Add_ShpGrps() {

		log.info("Adding Ship Groups for PO Encumbrance Flow");
		String facility = "_facilityId";

		for (int a = 0; a <= 1; a++) {
			Select Shpfacility = new Select(WebdriverWait.findElement("id", a + facility));
			if (a == 0) {
				Shpfacility.selectByVisibleText(PO_Enc_data.get(1).get("Facility-ShipGroup"));
				System.out.println(PO_Enc_data.get(1).get("Facility-ShipGroup"));
				WebdriverWait.findElement("name", "newShipGroup").click();
			} else if (a == 1) {
				Shpfacility.selectByVisibleText(PO_Enc_data.get(3).get("Facility-ShipGroup"));
				System.out.println(PO_Enc_data.get(3).get("Facility-ShipGroup"));
			}
		}
		WebdriverWait.findElement("xpath", "//*[@id='content-main-section']/div[2]/div[2]/div/a[1]").click();
	}

	public static void PO_Enc_Add_Prd() throws InterruptedException {

		for (int p = 0; p <= 3; p++) {
			log.info("Adding Products for Encumbrance Order");

			Select OrdType_DD = new Select(WebdriverWait.findElement("id", "addItemType"));
			OrdType_DD.selectByVisibleText(PO_Enc_data.get(0).get("OrderType"));

			Thread.sleep(1000);
			WebdriverWait.findElement("name", "add_product_id").sendKeys(PO_Enc_data.get(p).get("Product ID"));
			WebdriverWait.findElement("name", "quantity").sendKeys(PO_Enc_data.get(p).get("Qty"));

			Select UOM_DD = new Select(WebdriverWait.findElement("id", "quantityUomId"));
			UOM_DD.selectByVisibleText(PO_Enc_data.get(p).get("UOM"));

			Thread.sleep(1000);

			Select Dept_DD = new Select(WebdriverWait.findElement("id", "departmentName"));
			Dept_DD.selectByVisibleText(PO_Enc_data.get(p).get("Dept"));

			WebdriverWait.findElement("name", "itemComment").sendKeys("Test");

			Select Fac_DD = new Select(WebdriverWait.findElement("id", "toGroupIndex"));

			if (p <= 1) {
				Fac_DD.selectByVisibleText(PO_Enc_data.get(0).get("Facility-ShipGroup"));
			} else {
				Fac_DD.selectByVisibleText(PO_Enc_data.get(2).get("Facility-ShipGroup"));
			}
			WebdriverWait.findElement("name", "submitItems").click();
		}
		WebdriverWait.findElement("link", "Continue").click();
		WebdriverWait.findElement("link", "Create").click();
		log.info("PO Number Created Successfully");

		String Enc_PO_Num = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[1]/div[2]/table/tbody/tr[1]/td[2]/a")
				.getText();
		System.out.println("PO Number = " + Enc_PO_Num);
		EncPo_Number = Enc_PO_Num;
		ExcelWriter.writeExcelFile("PO_Enc", 8, 0, Enc_PO_Num);
	}

	public static void PO_Enc_GrdTotal_Val() {

		log.info("Validating GrandTotal");
		String PO_EncGrdTotal = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[6]/div[2]/table/tbody/tr[8]/td[3]/span")
				.getText().replace("₹", "").replace(",", "");
		System.out.println(PO_EncGrdTotal);
		System.out.println(PO_Enc_data.get(7).get("Product ID"));
		Assert.assertEquals(PO_Enc_data.get(7).get("Product ID"), PO_EncGrdTotal);
		log.info("Grand Total & Tax Amt validated Successfully for PO Encumbrance Flow");
	}

	public static void Po_Enc_Approve_Po() {

		log.info("Approve PO for Encumbrance");
		WebdriverWait.findElement("link", "Review Order").click();
		WebdriverWait.findElement("link", "Review 2 Order").click();
		WebdriverWait.findElement("link", "Approve Order").click();
		String App_Status_Val = WebdriverWait
				.findElement("xpath", "//*[@id='content-main-section']/div[1]/div[2]/table/tbody/tr[5]/td[2]")
				.getText();
		Assert.assertEquals("Approved", App_Status_Val);
		log.info("Status validated successfully as Approved");

	}

}
